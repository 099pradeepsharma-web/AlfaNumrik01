import{r as s,j as e,a as ne,J as le,K as oe,L as J,M as de,N as H,O as ce,G as me,E as xe,P as ue,Q as ge}from"./vendor_react-DXiryTHP.js";import{f as X,a as he,g as fe,b as be,u as V,c as pe,s as we,d as ke,e as ye,h as je,i as ve,j as Ne}from"./chapterview-B02STcsL.js";import W from"./loadingspinner-DNzNT9Ti.js";import{P as Se}from"./practiceexercises-LXlW4Hw3.js";import Ce from"./fittoavatar-BE-ozDqT.js";import{g as Ee}from"./iconmap-iBemgT8I.js";const Re=async(t,i,n,u)=>{if(await X(i))throw new Error("An account with this email already exists.");const l={id:Date.now(),name:t.trim(),email:i.trim().toLowerCase(),password_plaintext:n,grade:u,avatarUrl:`https://i.pravatar.cc/150?u=${encodeURIComponent(i.trim())}`};return await he(l),l},De=async(t,i)=>{const n=await X(t);if(!n)throw new Error("Invalid email or password.");if(!(n.password_plaintext===i))throw new Error("Invalid email or password.");return n},Y=s.createContext(void 0),Me=({children:t})=>{const[i,n]=s.useState(null),[u,m]=s.useState(!0),[l,x]=s.useState(null),f=s.useCallback(async o=>{const d=await fe(o.id),c={id:o.id,name:o.name,grade:o.grade,avatarUrl:o.avatarUrl,performance:d};n(c),sessionStorage.setItem("alfanumrik-userId",o.id.toString()),x(null)},[]);s.useEffect(()=>{(async()=>{const d=sessionStorage.getItem("alfanumrik-userId");if(d){const c=await be(parseInt(d,10));c&&await f(c)}m(!1)})()},[f]);const b={currentUser:i,isLoggedIn:!!i,loading:u,error:l,login:async(o,d)=>{m(!0),x(null);try{const c=await De(o,d);await f(c)}catch(c){throw x(c.message),c}finally{m(!1)}},signup:async(o,d,c,C)=>{m(!0),x(null);try{const p=await Re(o,d,c,C);await f(p)}catch(p){throw x(p.message),p}finally{m(!1)}},logout:()=>{n(null),sessionStorage.removeItem("alfanumrik-userId"),x(null)}};return e.jsx(Y.Provider,{value:b,children:t})},Ie=()=>{const t=s.useContext(Y);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},A=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,Te=t=>{const[i,n]=s.useState(!1),[u,m]=s.useState(""),l=s.useRef(null),x=s.useRef("");s.useEffect(()=>{if(!A){console.warn("Speech Recognition API is not supported in this browser.");return}const a=new A;return a.continuous=!1,a.interimResults=!0,a.lang="en-IN",a.onresult=h=>{let b="",o="";for(let d=h.resultIndex;d<h.results.length;++d)h.results[d].isFinal?o+=h.results[d][0].transcript:b+=h.results[d][0].transcript;m(x.current+b),o&&(x.current+=o)},a.onend=()=>{n(!1),t!=null&&t.onEnd&&x.current.trim()&&t.onEnd(x.current.trim())},a.onerror=h=>{console.error("Speech recognition error",h.error),n(!1)},l.current=a,()=>{l.current&&(l.current.stop(),l.current.onend=null,l.current.onresult=null,l.current.onerror=null)}},[t]);const f=s.useCallback(()=>{l.current&&!i&&(m(""),x.current="",l.current.start(),n(!0))},[i]),y=s.useCallback(()=>{l.current&&i&&l.current.stop()},[i]);return{isListening:i,transcript:u,startListening:f,stopListening:y,isSupported:!!A}},$e=({status:t})=>{const{t:i}=V();switch(t){case"mastered":return e.jsxs("span",{className:"flex items-center text-xs font-semibold px-2.5 py-0.5 rounded-full bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),i("mastered")]});case"in-progress":return e.jsxs("span",{className:"flex items-center text-xs font-semibold px-2.5 py-0.5 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),i("inProgress")]});default:return e.jsx("span",{className:"text-xs font-semibold px-2.5 py-0.5 rounded-full bg-slate-200 text-slate-600 dark:bg-slate-600 dark:text-slate-300",children:i("notStarted")})}},Fe=({concept:t,grade:i,subject:n,chapter:u,language:m,progressStatus:l,onMarkAsInProgress:x,onConceptMastered:f,renderText:y})=>{const{t:a}=V(),{currentUser:h}=Ie(),b=h,[o,d]=s.useState(""),[c,C]=s.useState(!1),[p,E]=s.useState([]),[Z,Q]=s.useState(!1),R=s.useRef(null),[T,_]=s.useState(null),[$,M]=s.useState(!1),[j,B]=s.useState(null),D=`diagram-${i.level}-${n.name}-${u.title}-${t.conceptTitle}`;s.useEffect(()=>{(async()=>{const g=await Ne(D);g&&_(g)})()},[D]);const ee=s.useCallback(async()=>{M(!0),B(null);try{const r=await pe(t.diagramDescription,n.name);await we(D,r),_(r)}catch(r){let g=a("diagramFailedError");r.message==="QUOTA_EXCEEDED"&&(g=a("diagramQuotaError")),B(g)}finally{M(!1)}},[t.diagramDescription,n.name,D,a]),te=Ee(n.icon),{isSpeaking:I,play:O,stop:F}=ke(),G=s.useCallback(async r=>{const g=r.trim();if(!g||c)return;C(!0),I&&F();const v={id:Date.now(),type:"user",text:g},N={id:Date.now()+1,type:"fitto",text:"",state:"thinking"};E(w=>[...w,v,N]),d("");const U={id:`q-${v.id}`,studentId:b.id,studentName:b.name,grade:i.level,subject:n.name,chapter:u.title,concept:t.conceptTitle,questionText:g,timestamp:new Date().toISOString()};try{await ye(U,m);const w=await je(U,m);O(w.responseText),E(S=>S.map(P=>P.id===N.id?{...P,text:w.responseText,state:void 0}:P));const L={...U,fittoResponse:w};await ve(L,m)}catch(w){E(L=>L.map(S=>S.id===N.id?{...S,text:w.message,state:"error"}:S))}finally{C(!1)}},[c,b,i,n,u,t.conceptTitle,m,O,I,F]),{isListening:k,transcript:K,startListening:se,stopListening:q,isSupported:re}=Te({onEnd:G}),ae=s.useCallback(()=>{f(t.conceptTitle)},[f,t.conceptTitle]);s.useEffect(()=>{d(K)},[K]),s.useEffect(()=>{E([{id:Date.now(),type:"fitto",text:a("fittoWelcome",{concept:t.conceptTitle})}])},[a,t.conceptTitle]),s.useEffect(()=>{R.current&&(R.current.scrollTop=R.current.scrollHeight)},[p]);const z=r=>{r.preventDefault(),k?q():G(o)},ie=()=>e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("div",{ref:R,className:"space-y-4 h-72 overflow-y-auto pr-2 rounded-lg bg-white dark:bg-slate-900/50 p-3 border border-slate-200 dark:border-slate-700",children:p.map((r,g)=>{if(r.type==="user")return e.jsx("div",{className:"flex justify-end animate-fade-in",children:e.jsx("div",{className:"chat-bubble user-bubble inline-block",children:r.text})},r.id);{const v=g===p.length-1,N=r.state==="thinking"?"thinking":r.state==="error"?"encouraging":v&&I?"speaking":"idle";return e.jsxs("div",{className:"flex items-end space-x-3 animate-fade-in",children:[e.jsx("div",{className:"flex-shrink-0 self-start",children:e.jsx(Ce,{state:N,size:40})}),e.jsx("div",{className:"flex-grow",children:e.jsxs("div",{className:"flex items-end gap-2",children:[r.state==="thinking"?e.jsx("div",{className:"chat-bubble fitto-bubble inline-block",children:e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}):r.state==="error"?e.jsx("div",{role:"status",className:"p-3 text-sm bg-red-100 dark:bg-red-900/50 text-red-800 dark:text-red-300 rounded-lg",children:r.text}):e.jsx("div",{className:"chat-bubble fitto-bubble",children:e.jsx("p",{className:"text-slate-700 dark:text-slate-200",children:r.text})}),v&&I&&!r.state&&e.jsx("button",{onClick:F,className:"flex-shrink-0 p-2 rounded-full bg-slate-200 dark:bg-slate-600 hover:bg-red-100 dark:hover:bg-red-800/50 text-slate-600 dark:text-slate-200 hover:text-red-500 dark:hover:text-red-400 transition","aria-label":"Stop speaking",children:e.jsx(xe,{className:"h-5 w-5"})})]})})]},`${r.id}-${r.state||"final"}`)}})}),e.jsxs("form",{onSubmit:z,className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("textarea",{value:o,onChange:r=>d(r.target.value),onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&z(r)},placeholder:k?"Listening...":a("askQuestionPlaceholder"),className:"w-full flex-grow p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 rounded-md focus:ring-2 focus:ring-primary focus:border-primary transition",rows:1,disabled:c}),re&&e.jsx("button",{type:"button",onClick:k?q:se,className:`flex-shrink-0 p-2.5 rounded-lg shadow-sm transition disabled:opacity-50 disabled:cursor-not-allowed ${k?"bg-red-500 text-white animate-pulse":"bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-500"}`,"aria-label":k?"Stop listening":"Start listening",children:e.jsx(ue,{className:"h-5 w-5"})}),e.jsx("button",{type:"submit",className:"flex-shrink-0 p-2.5 bg-primary text-white font-semibold rounded-lg shadow-sm hover:bg-primary-dark transition disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"rgb(var(--c-primary))"},disabled:c||!o.trim()&&!k,"aria-label":a("submitQuestion"),children:c?e.jsx(W,{}):e.jsx(ge,{className:"h-5 w-5"})})]})]});return e.jsxs("div",{className:"relative bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-6 transition-shadow hover:shadow-md not-prose",children:[l==="mastered"&&e.jsxs("div",{className:"absolute top-3 right-3 bg-green-500 text-white font-bold px-3 py-1 text-xs rounded-full shadow-lg flex items-center gap-1.5 animate-fade-in z-10",children:[e.jsx(ne,{className:"h-4 w-4"}),a("masteryBadge")]}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h3",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 flex items-center",children:[e.jsx(te,{className:"h-7 w-7 text-primary mr-3 flex-shrink-0",style:{color:"rgb(var(--c-primary))"}}),t.conceptTitle]}),e.jsx($e,{status:l})]}),e.jsx("div",{className:"text-slate-600 dark:text-slate-300 mb-4 whitespace-pre-wrap",children:y(t.explanation)}),l==="not-started"&&e.jsx("div",{className:"text-right mb-4",children:e.jsx("button",{onClick:x,className:"px-4 py-2 text-sm font-semibold bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition shadow-sm",children:a("markAsUnderstood")})}),e.jsxs("div",{className:"bg-primary-light border-l-4 border-primary/50 p-4 rounded-r-lg mb-4",style:{backgroundColor:"rgb(var(--c-primary-light))",borderColor:"rgba(var(--c-primary), 0.5)"},children:[e.jsxs("h4",{className:"font-semibold text-primary-dark flex items-center mb-2",style:{color:"rgb(var(--c-primary-dark))"},children:[e.jsx(le,{className:"h-5 w-5 mr-2"}),a("stemConnection")]}),e.jsx("div",{className:"text-primary-dark/80",style:{color:"rgba(var(--c-primary-dark), 0.8)"},children:y(t.realWorldExample)})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-semibold text-slate-700 dark:text-slate-200 flex items-center mb-2",children:[e.jsx(oe,{className:"h-5 w-5 mr-2"}),a("visualDiagram")]}),e.jsxs("div",{role:"status",className:"border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-4 text-center min-h-[200px] flex items-center justify-center bg-white dark:bg-slate-800",children:[$&&e.jsxs("div",{className:"flex flex-col items-center text-slate-500 dark:text-slate-400",children:[e.jsx("div",{className:"text-primary h-8 w-8",style:{color:"rgb(var(--c-primary))"},children:e.jsx(W,{})}),e.jsx("p",{className:"text-sm mt-2",children:a("aiDrawingDiagram")})]}),j&&e.jsxs("div",{className:"text-slate-500 dark:text-slate-400 flex flex-col items-center p-4",children:[j===a("diagramQuotaError")?e.jsx(J,{className:"h-10 w-10 mb-3 text-amber-500"}):e.jsx(de,{className:"h-10 w-10 mb-3 text-red-500"}),e.jsx("p",{className:"font-semibold text-center",children:j}),e.jsxs("p",{className:"text-xs italic mt-3 text-slate-400 dark:text-slate-500 text-center",children:[e.jsxs("strong",{children:[a("visualContext"),":"]}),' "',t.diagramDescription,'"']})]}),!$&&!j&&T&&e.jsxs("div",{children:[e.jsx("img",{src:T,alt:t.diagramDescription,className:"rounded-md mx-auto mb-2 max-h-[300px] w-auto bg-white"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic",children:t.diagramDescription})]}),!$&&!j&&!T&&t.diagramDescription&&t.diagramDescription.trim().length>10&&e.jsxs("button",{onClick:ee,className:"flex flex-col items-center justify-center text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary-light transition-colors group",children:[e.jsx(H,{className:"h-10 w-10 mb-2 transition-transform group-hover:scale-110"}),e.jsx("span",{className:"font-semibold",children:a("generateDiagramButton")})]})]})]}),e.jsx("div",{className:"mt-6",children:Z?e.jsx(Se,{concept:t,grade:i,subject:n,chapter:u,language:m,onClose:()=>Q(!1),onMastered:ae}):e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:()=>Q(!0),className:"inline-flex items-center px-6 py-2 bg-white dark:bg-slate-700 border border-primary/50 text-primary-dark font-semibold rounded-lg shadow-sm hover:bg-primary-light dark:hover:bg-slate-600 transition",style:{borderColor:"rgba(var(--c-primary), 0.5)",color:"rgb(var(--c-primary-dark))"},children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),a("practiceThisConcept")]})})}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("h4",{className:"text-lg font-bold text-slate-700 dark:text-slate-200 flex items-center mb-4",children:[e.jsx(H,{className:"h-6 w-6 mr-2 text-primary",style:{color:"rgb(var(--c-primary))"}}),a("askFitto")]}),ie()]})]})},Be=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));export{Me as A,Be as C,Ie as u};
