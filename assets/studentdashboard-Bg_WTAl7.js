import{R as L,j as e,k as I,r as m,T,ae as _,af as W,q as U,ag as K,w as z}from"./vendor_react-DXiryTHP.js";import{u as w,g as G,w as V,m as Y,o as q,x as H,p as J,y as O,j as Q,c as X,s as Z}from"./chapterview-B02STcsL.js";import{u as ee}from"./conceptcard-CDDsxe1s.js";import B from"./loadingspinner-DNzNT9Ti.js";import te from"./fittoavatar-BE-ozDqT.js";import{C as se}from"./personalizedpath-CMywhJ14.js";const ae=({streak:r})=>{const{t:i}=w();return r<2?null:e.jsxs("div",{className:"dashboard-highlight-card streak-card-gradient p-6 rounded-2xl shadow-lg flex items-center gap-4",children:[e.jsx(K,{className:"h-12 w-12 text-amber-900 dark:text-amber-100 opacity-80"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-streak-text dark:text-streak-text",children:i("learningStreakText",{count:r})}),e.jsx("p",{className:"font-semibold text-streak-text/80 dark:text-streak-text/80",children:"Keep the fire burning!"})]})]})},re=L.memo(({record:r})=>{const{t:i,tCurriculum:n}=w();let t="",a=e.jsx(I,{className:"h-6 w-6"}),d="activity-icon-bg-academic";r.type==="iq"?(t=i("iqChallengeCompleted"),a=e.jsx(z,{className:"h-6 w-6"}),d="activity-icon-bg-iq"):r.type==="eq"?(t=i("eqChallengeCompleted"),a=e.jsx(T,{className:"h-6 w-6"}),d="activity-icon-bg-eq"):(t=i("academicChapter",{chapter:n(r.chapter),subject:n(r.subject)}),a=e.jsx(I,{className:"h-6 w-6"}));const o=(j=>j>85?{class:"activity-score-high",text:i("badgeMastery")}:j>70?{class:"activity-score-medium",text:i("badgeProficient")}:{class:"activity-score-low",text:i("badgeImproving")})(r.score);return e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl flex items-center gap-4 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:`flex-shrink-0 activity-icon-bg ${d}`,children:a}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100 leading-tight",children:t}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:r.context?`${i("skill")}: ${r.context}`:new Date(r.completedDate).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-2",children:[e.jsxs("div",{className:`activity-score ${o.class}`,children:[r.score,"%"]}),e.jsx("p",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 text-center mt-1",children:o.text})]})]})}),le=({onStartMission:r,student:i})=>{const{t:n,language:t}=w(),[a,d]=m.useState(null),[s,o]=m.useState(!0);m.useEffect(()=>{(async()=>{o(!0);try{const u=await q(i,t);d(u)}catch(u){console.error("Failed to fetch adaptive action:",u)}finally{o(!1)}})()},[i,t]);const f=(v=>{switch(v){case"ACADEMIC_REVIEW":return{label:n("easy"),color:"rgb(var(--c-success))",dots:1};case"ACADEMIC_PRACTICE":return{label:n("medium"),color:"#FBBF24",dots:2};case"ACADEMIC_NEW":return{label:n("hard"),color:"rgb(var(--c-error))",dots:3};default:return{label:n("medium"),color:"#FBBF24",dots:2}}})(a==null?void 0:a.type),p=(a==null?void 0:a.details.confidence)||0;let y="rgb(var(--c-error))";return p>.9?y="rgb(var(--c-success))":p>.7&&(y="#FBBF24"),s?e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 min-h-[220px] flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3 text-slate-500 dark:text-slate-400",children:[e.jsx(B,{}),e.jsx("span",{className:"font-semibold",children:n("craftingYourPath")})]})}):a?e.jsxs("div",{className:"dashboard-highlight-card mission-card-gradient rounded-2xl",children:[e.jsx("div",{className:"smart-card-confidence-bar",style:{"--confidence":`${p*100}%`,"--confidence-color":y},title:`AI Confidence: ${Math.round(p*100)}%`}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"ai-generated-tag mb-2",children:[e.jsx(U,{className:"h-3.5 w-3.5 mr-1.5"}),"AI-Personalized"]}),e.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100",children:n("todaysMission")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"difficulty-dots","aria-label":`Difficulty: ${f.label}`,children:Array.from({length:3}).map((v,u)=>e.jsx("div",{className:"difficulty-dot",style:{backgroundColor:u<f.dots?f.color:"rgb(var(--c-border))"}},u))}),e.jsx("span",{className:"text-xs font-bold mt-1.5 inline-block",style:{color:f.color},children:f.label})]})]}),e.jsxs("div",{className:"mt-6 bg-primary-light/50 dark:bg-slate-900/40 p-4 rounded-lg border border-primary/20 dark:border-slate-700",style:{borderColor:"rgba(var(--c-primary), 0.2)"},children:[e.jsx("p",{className:"font-semibold text-sm text-primary-dark dark:text-primary-light mb-1",style:{color:"rgb(var(--c-primary-dark))"},children:"AI Recommendation"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-300 italic",children:['"',a.details.reasoning,'"']})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:r,className:"flex items-center justify-center w-full md:w-auto px-6 py-3 text-white font-bold rounded-lg btn-primary-gradient",children:[e.jsx("span",{children:n("launchMission")}),e.jsx(_,{className:"h-5 w-5 ml-2"})]})})]})]}):null},ie=({message:r})=>e.jsxs("div",{className:"flex items-start gap-3 animate-fade-in",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx(te,{state:"speaking",size:56})}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"chat-bubble fitto-bubble text-base",children:e.jsx("p",{className:"text-slate-700 dark:text-slate-200",children:r})})})]}),ce=({onStartMission:r,onBrowse:i,onStartWellbeing:n})=>{const{t,tCurriculum:a,language:d}=w(),{currentUser:s}=ee(),[o,j]=m.useState([]),[f,p]=m.useState(0),[y,v]=m.useState(!1),[u,S]=m.useState(!0);m.useEffect(()=>{(async()=>{if(s){const x=await G(s.id);x.sort((h,N)=>new Date(N.completedDate).getTime()-new Date(h.completedDate).getTime()),j(x);const c=await V(s.id);p((c==null?void 0:c.count)||0),S(!0);const l=await Y(s.id);v(l),S(!1)}})()},[s]),m.useEffect(()=>{const x=setTimeout(async()=>{var c;if(s)try{const l=await q(s,d);if(!l.type.startsWith("ACADEMIC")||!l.details.subject||!l.details.chapter)return;const{subject:h,chapter:N}=l.details,C=(c=se.find(g=>g.level===s.grade))==null?void 0:c.subjects.find(g=>g.name===h);if(!C)return;const A=C.chapters.findIndex(g=>g.title===N);if(A===-1)return;const P=C.chapters.slice(A,A+3).map(async g=>{const R=`module-${s.grade}-${h}-${g.title}`;if(await H(R,d))return;const F=await J(s.grade,h,g.title,s.name,d);await O(R,F,d),F.keyConcepts.forEach(async k=>{const E=`diagram-${s.grade}-${h}-${g.title}-${k.conceptTitle}`;if(!await Q(E)&&k.diagramDescription&&k.diagramDescription.trim().length>10)try{const D=await X(k.diagramDescription,h);await Z(E,D)}catch(D){console.error(`Alfanumrik: Failed to pre-fetch diagram for "${k.conceptTitle}".`,D)}})});await Promise.allSettled(P)}catch(l){console.error("Alfanumrik: Background pre-fetch failed:",l)}},3e3);return()=>clearTimeout(x)},[s,d]);const $=m.useMemo(()=>{if(!s||o.length===0)return[t("rec_welcome"),t("rec_general_tip")];const b=[],x=[...o].sort((h,N)=>h.score-N.score),c=x[0],l=x[x.length-1];return(l==null?void 0:l.score)>85&&l.type!=="iq"&&l.type!=="eq"&&b.push(t("rec_strength",{context:a(l.chapter),score:l.score,subject:a(l.subject)})),(c==null?void 0:c.score)<70&&b.push(t("rec_weakness",{context:a(c.chapter),score:c.score,subject:a(c.subject)})),b.push(t("rec_general_tip")),b},[o,t,a,s]),M=o.slice(0,5);return s?e.jsxs("div",{className:"animate-fade-in space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold text-slate-800 dark:text-slate-100",children:[t("welcomeBack",{name:s.name.split(" ")[0]})," ðŸ‘‹"]}),e.jsx("p",{className:"text-lg text-slate-500 dark:text-slate-400 mt-1",children:t("dashboardSubtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-8",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-8",children:[e.jsx(le,{onStartMission:r,student:s}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mb-4",children:t("fittoRecommendations")}),$[0]&&e.jsx(ie,{message:$[0]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsx(ae,{streak:f}),u?e.jsx("div",{className:"dashboard-highlight-card p-6 rounded-2xl flex items-center justify-center min-h-[150px]",children:e.jsx(B,{})}):y&&e.jsxs("div",{className:"dashboard-highlight-card bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/50 dark:to-purple-900/50 p-6 rounded-2xl shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"p-3 bg-white/50 dark:bg-slate-900/50 rounded-full",children:e.jsx(T,{className:"h-8 w-8 text-indigo-500 dark:text-indigo-300"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"A Special Module"}),e.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400",children:"Assigned by your parent"})]})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4",children:'Explore the "Great Transformation" module to learn about personal growth and well-being.'}),e.jsxs("button",{onClick:n,className:"flex items-center justify-center w-full px-4 py-2 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition",children:[e.jsx("span",{children:"Explore Module"}),e.jsx(_,{className:"h-4 w-4 ml-2"})]})]}),e.jsxs("button",{onClick:i,className:"dashboard-highlight-card w-full p-6 rounded-2xl flex items-center gap-4 text-left",children:[e.jsx("div",{className:"p-3 bg-primary-light rounded-full",style:{backgroundColor:"rgb(var(--c-primary-light))"},children:e.jsx(W,{className:"h-8 w-8 text-primary-dark",style:{color:"rgb(var(--c-primary-dark))"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:t("exploreAllTopics")}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:t("exploreAllTopicsDesc")})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mb-4 border-b border-slate-200 dark:border-slate-700 pb-3",children:t("recentActivity")}),e.jsx("div",{className:"space-y-4",children:M.length>0?M.map((b,x)=>e.jsx(re,{record:b},x)):e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center py-8",children:t("noPerformanceData")})})]})]})]})]}):null},fe=L.memo(ce);export{fe as S};
