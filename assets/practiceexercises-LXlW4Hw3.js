import{r as d,j as e,g as I,G as P,ad as $,b as O}from"./vendor_react-DXiryTHP.js";import{u as D,v as G,l as T}from"./chapterview-B02STcsL.js";import M from"./loadingspinner-DNzNT9Ti.js";import{u as U}from"./conceptcard-CDDsxe1s.js";const J=({concept:c,grade:u,subject:f,chapter:p,language:j,onClose:y,onMastered:k})=>{const{t:s}=D(),{currentUser:v}=U(),N=v,[t,w]=d.useState(null),[o,m]=d.useState(!1),[x,b]=d.useState(null),[a,S]=d.useState(0),[n,g]=d.useState(null),[h,C]=d.useState(0),[F,A]=d.useState(!1),E=async()=>{m(!0),b(null);try{const r=await G(c,u.level,j);w(r)}catch(r){b(r.message)}finally{m(!1)}},Q=r=>{n||(g(r),r===t[a].correctAnswer&&C(l=>l+1))},R=async()=>{if(a===t.length-1){const l=Math.round(h/t.length*100),i={subject:f.name,chapter:p.title,score:l,completedDate:new Date().toISOString(),type:"exercise",context:c.conceptTitle};await T(N.id,i),l>=75&&k(),A(!0)}else S(l=>l+1),g(null)},L=r=>{if(!n)return"bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-600 hover:border-primary";const l=r===t[a].correctAnswer,i=r===n;return l?"bg-green-100 dark:bg-green-900/50 border-green-500 ring-2 ring-green-300":i&&!l?"bg-red-100 dark:bg-red-900/50 border-red-500 ring-2 ring-red-300":"bg-slate-100 dark:bg-slate-700 border-slate-300 dark:border-slate-500 opacity-70"};return F?e.jsxs("div",{className:"mt-4 p-4 border-t-2 border-dashed dark:border-slate-600 text-center animate-fade-in",children:[e.jsx("h4",{className:"text-xl font-bold text-slate-700 dark:text-slate-100",children:s("exerciseSummary")}),e.jsxs("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:[s("yourScore"),":"]}),e.jsxs("div",{className:"text-4xl font-bold text-primary my-2",style:{color:"rgb(var(--c-primary))"},children:[h," / ",t==null?void 0:t.length]}),e.jsx("button",{onClick:y,className:"mt-3 px-6 py-2 bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 font-semibold rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500 transition",children:s("close")})]}):e.jsxs("div",{className:"mt-4 p-4 border-t-2 border-dashed dark:border-slate-600 animate-fade-in",children:[!t&&e.jsxs("div",{className:"text-center",children:[e.jsx("button",{onClick:E,disabled:o,className:"flex items-center justify-center mx-auto px-6 py-3 bg-primary text-white font-bold rounded-lg shadow-md hover:bg-primary-dark transition-transform transform hover:scale-105 disabled:bg-indigo-300 disabled:cursor-not-allowed",style:{backgroundColor:"rgb(var(--c-primary))"},children:o?e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsx("span",{className:"ml-2",children:s("generatingExercises")})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:s("generateExercises")})]})}),x&&e.jsx("p",{className:"text-red-500 dark:text-red-400 mt-3",children:x})]}),t&&t.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-lg font-bold text-slate-700 dark:text-slate-100",children:s("practiceThisConcept")}),e.jsxs("span",{className:"text-sm font-semibold text-slate-600 dark:text-slate-300",children:[a+1," / ",t.length]})]}),e.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-200 mb-4",children:t[a].question}),e.jsx("div",{className:"space-y-3",children:t[a].options.map(r=>e.jsxs("button",{onClick:()=>Q(r),disabled:!!n,className:`w-full text-left p-3 rounded-lg border-2 transition-all duration-200 flex items-center text-slate-800 dark:text-slate-200 ${L(r)}`,children:[e.jsx("span",{className:`h-5 w-5 rounded-full border-2 ${n===r?"border-primary bg-primary":"border-slate-400 dark:border-slate-500"} mr-3 flex-shrink-0`,style:{borderColor:n===r?"rgb(var(--c-primary))":"",backgroundColor:n===r?"rgb(var(--c-primary))":""}}),r]},r))}),n&&e.jsxs("div",{className:"mt-4 animate-fade-in",children:[n===t[a].correctAnswer?e.jsxs("div",{className:"flex items-center text-green-600 dark:text-green-400 font-bold",children:[e.jsx(P,{className:"h-6 w-6 mr-2"})," ",s("correct")]}):e.jsxs("div",{className:"flex items-center text-red-600 dark:text-red-400 font-bold",children:[e.jsx($,{className:"h-6 w-6 mr-2"})," ",s("incorrect")]}),e.jsxs("div",{className:"mt-2 p-3 bg-primary-light dark:bg-slate-700/50 rounded-md text-primary-dark/80 dark:text-slate-300 flex items-start",children:[e.jsx(O,{className:"h-5 w-5 mr-2 flex-shrink-0 mt-0.5 text-primary",style:{color:"rgb(var(--c-primary))"}}),e.jsxs("span",{children:[e.jsxs("span",{className:"font-semibold",children:[s("explanation"),":"]})," ",t[a].explanation]})]}),e.jsx("div",{className:"text-right mt-4",children:e.jsx("button",{onClick:R,className:"px-6 py-2 bg-primary text-white font-semibold rounded-lg shadow hover:bg-primary-dark transition",style:{backgroundColor:"rgb(var(--c-primary))"},children:a===t.length-1?s("finishPractice"):s("nextQuestion")})})]})]})]})};export{J as P};
